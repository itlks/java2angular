<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:jsp="http://java.sun.com/JSP/Page"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="/templates/template_com_migalhaNovo.xhtml">


	<ui:define name="content">
		<ui:include src="//commons/inicializaDL.xhtml"></ui:include>
		<ui:include src="/commons/gerarNovoReferOper.xhtml" />

		<p:outputPanel styleClass="row">
			<p:outputPanel styleClass="col-xs-12">
				<p:outputPanel
					styleClass="aviso-interno-blocos alert-information flex-align-v box-shadow">
					<i class="fa fa-exclamation-circle space-rr"></i>
					<span> <h:outputText styleClass="row"
							value="#{msg['pages.usuarioSecundario.alterarPreenchimento2.neste.secao.voce']}" />
					</span>
				</p:outputPanel>
			</p:outputPanel>
		</p:outputPanel>


		<p:outputPanel styleClass="row">
			<p:outputPanel styleClass="col-xs-12 ">
				<p:outputPanel styleClass="titulo-painel">
					<h4>
						<h:outputText
							value="#{msg['pages.administrativo.usuarioSecundarioIncluir.wizard3']}" />
					</h4>
				</p:outputPanel>
			</p:outputPanel>
		</p:outputPanel>

		<p:outputPanel styleClass="row">
			<p:outputPanel styleClass="col-xs-12">
				<p:outputPanel styleClass="box-shadow">


					<p:outputPanel styleClass="space-b">
						<p:outputPanel styleClass="row">
							<p:outputPanel styleClass="col-xs-4">
								<h:outputLabel for="usuSecNomeCompleto" styleClass="space"
									value="#{msg['pages.administrativo.usuarioSecundario.usuarioInclusaoPerfil.label.nome']}" />
								<h:outputText id="usuSecNomeCompleto"
									value="#{usuarioSecundarioIncluirBBean.dto.nomeUsuario}" />
							</p:outputPanel>

							<p:outputPanel styleClass="col-xs-4">
								<h:outputLabel for="cpf" styleClass="space"
									value="#{msg['pages.administrativo.usuarioSecundario.usuarioInclusaoPerfil.label.cpf']}" />
								<h:outputText id="cpf"
									value="#{usuarioSecundarioIncluirBBean.dto.nrCpf}"
									converter="converterCpfCnpj" />
							</p:outputPanel>
						</p:outputPanel>

						<p:outputPanel styleClass="row">
							<p:outputPanel styleClass="col-xs-4">
								<h:outputLabel for="usuSecArea" styleClass="space"
									value="#{msg['pages.administrativo.usuarioSecundario.usuarioInclusaoPerfil.label.area']}" />
								<h:outputText id="usuSecArea"
									value="#{usuarioSecundarioIncluirBBean.dto.nomeArea}" />
							</p:outputPanel>
						</p:outputPanel>
						<p:outputPanel styleClass="row">
							<p:outputPanel styleClass="col-xs-4">
								<h:outputLabel for="usuSecAcesso" styleClass="space"
									value="#{msg['pages.administrativo.usuarioSecundario.usuarioInclusaoPerfil.label.acesso']}" />
								<h:outputText id="usuSecAcesso"
									value="#{usuarioSecundarioIncluirBBean.dto.nomeLogon}" />
							</p:outputPanel>
						</p:outputPanel>


						<p:outputPanel styleClass="row">
							<p:outputPanel styleClass="col-xs-4">
								<h:outputLabel for="usuSecTelFixo" styleClass="space"
									value="#{msg['pages.administrativo.usuarioSecundario.usuarioInclusaoPerfil.label.contato']}" />
								<h:outputText id="usuSecTelFixo"
									value="#{usuarioSecundarioIncluirBBean.dto.nrTelefone}"
									converter="converterCelularTelefone" />
							</p:outputPanel>
						</p:outputPanel>

						<p:outputPanel styleClass="row"
							rendered="#{usuarioSecundarioIncluirBBean.exibeCelular}">
							<p:outputPanel styleClass="col-xs-4">
								<h:outputLabel for="usuSecTelCel" styleClass="space"
									value="#{msg['page.administrativo.usuarioSecundario.incluir.telefoneCelular']}" />
								<h:outputText id="usuSecTelCel"
									value="#{usuarioSecundarioIncluirBBean.dto.nrCelular}"
									converter="converterCelularTelefone" />
							</p:outputPanel>
						</p:outputPanel>

						<p:outputPanel styleClass="row">
							<p:outputPanel styleClass="col-xs-4">
								<h:outputLabel for="acessoMobile" styleClass="space"
									value="#{msg['pages.administrativo.usuarioSecundario.usuarioInclusaoPerfil.label.mobile.banking']}" />
								<h:outputText id="acessoMobile"
									value="#{usuarioSecundarioIncluirBBean.dto.inAcesMobl == msg['pages.administrativo.usuarioSecundarioAlterar.table.habilitado'] ?  msg['padrao.sim'] : msg['padrao.nao']}" />
							</p:outputPanel>
						</p:outputPanel>
					</p:outputPanel>

					<p:outputPanel styleClass="row update-class">
						<p:outputPanel styleClass="col-xs-4"
							rendered="#{usuarioSecundarioIncluirBBean.expandedRow}">
							<span style="color: red;">></span>
							<p:commandLink update=":formGeral" process="@this"
								action="#{usuarioSecundarioIncluirBBean.setExpandedRow(false)}">
								<h:outputText
									value="#{msg['pages.usuarioSecundario.alterarPreenchimento2.retrair.todas.areas']}" />
							</p:commandLink>
						</p:outputPanel>

						<p:outputPanel styleClass="col-xs-4"
							rendered="#{!usuarioSecundarioIncluirBBean.expandedRow}">
							<span style="color: red;">></span>
							<p:commandLink update=":formGeral" process="@this"
								action="#{usuarioSecundarioIncluirBBean.setExpandedRow(true)}">
								<h:outputText
									value="#{msg['pages.usuarioSecundario.alterarPreenchimento2.expandir.todas.areas']}" />
							</p:commandLink>
						</p:outputPanel>
					</p:outputPanel>

					<p:outputPanel styleClass="row">
						<p:outputPanel styleClass="col-xs-12">

							<p:panelGrid
								styleClass="table-perfil-autorizacao grid-header no-border">

								<f:facet name="header">
									<p:row>
										<p:column styleClass="col-xs-4">
											<p:outputLabel styleClass="space"
												value="#{msg['pages.usuarioSecundario.alterarPreenchimento2.convenio']}" />
										</p:column>

										<p:column styleClass="col-xs-4">
											<p:outputLabel styleClass="space"
												value="#{msg['pages.usuarioSecundario.alterarPreenchimento2.permitir.acesso']}" />
											<p:graphicImage id="acesso"
												styleClass="tooptip-usuario acesso"
												value="#{usuarioSecundarioIncluirBBean.imagem}" />
											<pe:tooltip for="acesso" styleClass="associar-tooltip"
												value="#{msg['pages.usuarioSecundario.usuarioInclusaoConvenio.tooltip.acesso']}"
												myPosition="left center" atPosition="right center" />
										</p:column>

										<p:column styleClass="col-xs-4">

											<p:outputLabel styleClass="space"
												value="#{msg['pages.usuarioSecundario.alterarPreenchimento2.perfil.autorizacao']}" />
											<p:graphicImage id="perfil"
												value="#{usuarioSecundarioIncluirBBean.imagem}"
												styleClass="tooptip-usuario autorizacao" />
											<pe:tooltip for="perfil" styleClass="associar-tooltip"
												value="#{msg['pages.usuarioSecundario.usuarioInclusaoConvenio.tooltip.perfil']}"
												myPosition="left center" atPosition="right center" />

										</p:column>
									</p:row>

									<p:row>
										<p:column styleClass="col-xs-4 column-header-custom">
											<p:selectBooleanCheckbox styleClass="space"
												value="#{usuarioSecundarioIncluirBBean.aplicarTodos}">

												<p:ajax onsuccess="dataTableConveniosUpdate();"
													listener="#{usuarioSecundarioIncluirBBean.aplicarTodosConvenios}" />
											</p:selectBooleanCheckbox>
											<h:outputText
												value="#{msg['pages.usuarioSecundario.alterarPreenchimento2.aplicar.todos.convenio']}" />
										</p:column>

										<p:column styleClass="col-xs-4 column-header-custom">
											<p:selectBooleanCheckbox
												value="#{usuarioSecundarioIncluirBBean.permitirAcesso}"
												disabled="#{!usuarioSecundarioIncluirBBean.aplicarTodos}">
												<p:ajax event="change"
													onsuccess="dataTableConveniosUpdate();"
													listener="#{usuarioSecundarioIncluirBBean.permitirAcessoTodos}" />
											</p:selectBooleanCheckbox>
										</p:column>

										<p:column styleClass="col-xs-4 column-header-custom">
											<h:selectOneMenu
												disabled="#{!usuarioSecundarioIncluirBBean.aplicarTodos}"
												value="#{usuarioSecundarioIncluirBBean.select}">

												<p:ajax event="change"
													onsuccess="dataTableConveniosUpdate();"
													listener="#{usuarioSecundarioIncluirBBean.setPerfil}" />

												<f:selectItem
													itemLabel="#{msg['pages.administrativo.usuarioSecundario.usuarioInclusaoPerfil.combobox.selecione']}"
													itemValue="0" noSelectionOption="true" />

												<f:selectItems itemLabel="#{perfil.numPerfilAcesso}"
													itemValue="#{perfil.numSequPerfilAutorizacaoSec}"
													var="perfil"
													value="#{usuarioSecundarioIncluirBBean.listaPerfisAutorizacaoContrato}" />

											</h:selectOneMenu>
										</p:column>

									</p:row>
								</f:facet>
							</p:panelGrid>




							<p:outputPanel styleClass="update-class table-no-header noHover">
								<p:dataTable id="dataConvenios" var="u" emptyMessage=""
									value="#{usuarioSecundarioIncluirBBean.convenios}"
									expandedRow="#{usuarioSecundarioIncluirBBean.expandedRow}">

									<p:column styleClass="custom-rowToggler fundoGelo">
										<p:rowToggler rendered="#{!u.list.isEmpty()}" />
										<h:outputText value="#{u.header}" />
									</p:column>

									<p:rowExpansion id="rowExpansion" styleClass="no-padding">


										<h:outputText rendered="#{u.list.isEmpty()}"
											styleClass="tabelaVazia"
											value="#{msg['pages.administrativo.usuarioSecundarioAlterar.table.emptyMessage']}" />

										<p:dataTable var="d" value="#{u.list}" id="dataUser"
											tableStyleClass="table-td-equals form-group-no-margin"
											rendered="#{!u.list.isEmpty()}"
											emptyMessage="#{msg['pages.administrativo.usuarioSecundarioAlterar.table.emptyMessage']}">

											<p:column styleClass="col-xs-4">
												<h:outputText value="#{d.convenio}" styleClass="space-l" />
											</p:column>

											<p:column styleClass="col-xs-4">
												<p:selectBooleanCheckbox value="#{d.permitirAcessoBoolean}"
													disabled="#{usuarioSecundarioIncluirBBean.aplicarTodos}">
													<p:ajax event="change" />
												</p:selectBooleanCheckbox>
											</p:column>

											<p:column styleClass="col-xs-4">
												<h:selectOneMenu id="perfilAutorizacao"
													value="#{d.perfilAutorizacao}"
													disabled="#{usuarioSecundarioIncluirBBean.aplicarTodos}"
													rendered="#{d.lPerfilContrato != null and !d.lPerfilContrato.isEmpty()}">

													<p:ajax event="change" />

													<f:selectItem
														itemLabel="#{msg['pages.administrativo.usuarioSecundario.usuarioInclusaoPerfil.combobox.selecione']}"
														itemValue="0" />
													<f:selectItems id="teste"
														itemLabel="#{perfilAuto.numPerfilAcesso}"
														itemValue="#{perfilAuto.numSequPerfilAutorizacaoSec}"
														var="perfilAuto" value="#{d.lPerfilContrato}" />
												</h:selectOneMenu>
												<h:outputText
													rendered="#{d.lPerfilContrato == null or d.lPerfilContrato.isEmpty()}"
													value="#{d.perfilAutorizacao}" />
											</p:column>
										</p:dataTable>
									</p:rowExpansion>
								</p:dataTable>
							</p:outputPanel>
						</p:outputPanel>
					</p:outputPanel>
				</p:outputPanel>
			</p:outputPanel>
		</p:outputPanel>

		<p:remoteCommand name="dataTableConveniosUpdate" update=":formGeral"
			process="@this" />

		<p:outputPanel styleClass="row space-b">
			<p:outputPanel styleClass="col-xs-12 text-right">

				<p:commandButton styleClass="btn btn-default btn-secundario"
					role="button"
					value="#{msg['pages.usuarioSecundario.alterarPreenchimento2.voltar']}"
					action="#{usuarioSecundarioIncluirBBean.voltarParaPreenchimentoPerfil()}" />

				<p:blockUI block="btnContinuar" trigger="btnContinuar" />
				<p:commandButton id="btnContinuar" styleClass="btn btn-default"
					value="#{msg['pages.usuarioSecundario.alterarPreenchimento2.continuar']}"
					action="#{usuarioSecundarioIncluirBBean.confirmarSelecaoConvenio}"
					role="button" />
				<p:defaultCommand target="btnContinuar" />
			</p:outputPanel>
		</p:outputPanel>
	</ui:define>
</ui:composition>